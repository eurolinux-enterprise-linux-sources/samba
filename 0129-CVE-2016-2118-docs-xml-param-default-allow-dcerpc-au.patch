From 595cd06790b6ce5a3096092a584c3e0923f04b05 Mon Sep 17 00:00:00 2001
From: Stefan Metzmacher <metze@samba.org>
Date: Thu, 10 Mar 2016 17:03:59 +0100
Subject: [PATCH 129/321] CVE-2016-2118: docs-xml/param: default "allow dcerpc
 auth level connect" to "no"

BUG: https://bugzilla.samba.org/show_bug.cgi?id=11616

Signed-off-by: Stefan Metzmacher <metze@samba.org>
Reviewed-by: Alexander Bokovoy <ab@samba.org>
(backported from commit 6469e21af32a2a405dd4f43e7d96a2f87c4a9902)

Conflicts:
	lib/param/loadparm.c
	source3/param/loadparm.c
---
 docs-xml/smbdotconf/security/allowdcerpcauthlevelconnect.xml | 6 ++----
 source3/param/loadparm.c                                     | 2 +-
 2 files changed, 3 insertions(+), 5 deletions(-)

diff --git a/docs-xml/smbdotconf/security/allowdcerpcauthlevelconnect.xml b/docs-xml/smbdotconf/security/allowdcerpcauthlevelconnect.xml
index 555211274ed..c8e9d18e103 100644
--- a/docs-xml/smbdotconf/security/allowdcerpcauthlevelconnect.xml
+++ b/docs-xml/smbdotconf/security/allowdcerpcauthlevelconnect.xml
@@ -14,11 +14,9 @@
 	E.g. the drsuapi and backupkey protocols require DCERPC_AUTH_LEVEL_PRIVACY.
 	While others like samr and lsarpc have a hardcoded default of <constant>no</constant>.
 	</para>
-
-	<para>Note the default will very likely change to <constant>no</constant> for Samba 4.5.</para>
 </description>
 
-<value type="default">yes</value>
-<value type="example">no</value>
+<value type="default">no</value>
+<value type="example">yes</value>
 
 </samba:parameter>
diff --git a/source3/param/loadparm.c b/source3/param/loadparm.c
index 87d33c5ce76..a514727ef5d 100644
--- a/source3/param/loadparm.c
+++ b/source3/param/loadparm.c
@@ -5381,7 +5381,7 @@ static void init_globals(bool reinit_globals)
 	Globals.bClientNTLMv2Auth = True; /* Client should always use use NTLMv2, as we can't tell that the server supports it, but most modern servers do */
 	/* Note, that we will also use NTLM2 session security (which is different), if it is available */
 
-	Globals.bAllowDcerpcAuthLevelConnect = true; /* we need to allow this for now by default */
+	Globals.bAllowDcerpcAuthLevelConnect = false; /* we don't allow this by default */
 
 	Globals.map_to_guest = 0;	/* By Default, "Never" */
 	Globals.oplock_break_wait_time = 0;	/* By Default, 0 msecs. */
-- 
2.14.3

